{% extends "result/base.html" %}

{% block app_content %}
    <h1>{{ title }}</h1>
    <div class="panel-group">
        <div class="panel panel-info">
            <div class="panel-heading">
                <h3 class="panel-title">
                    <a class="collapse-toggle" data-toggle="collapse" href="#info-panel-collapse">Result</a>
                </h3>
            </div>
            <div id="info-panel-collapse" class="panel-collapse collapse in">
                <div id="info-panel" class="panel-body">
                    <div class="row show-grid">
                        <div class="col-md-3">
                            <div class="panel panel-default">
                                <div class="panel-heading"><h4 class="panel-title">Subject</h4></div>
                                <div class="panel-body"><a href="{{ url_for('gui.subject', id=mainresult.subject.id) }}"> {{ mainresult.subject.name }} </a></div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="panel panel-default">
                                <div class="panel-heading"><h4 class="panel-title">Scan</h4></div>
                                <div class="panel-body"><a href="{{ url_for('gui.scan', id=mainresult.scan.id) }}"> {{ mainresult.scan }} </a></div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="panel panel-default">
                                <div class="panel-heading"><h4 class="panel-title">Created</h4></div>
                                <div class="panel-body">{{ mainresult.created_at.strftime("%m/%d/%Y, %H:%M:%S") }}
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row show-grid">
                        <div class="col-md-3">
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    <h4 class="panel-title" style="display: inline;">Tags</h4>
                                    <a href="{{url_for('gui.import_result_tags_from_soft_matches',id=mainresult.id)}}">
                                        <span class="glyphicon glyphicon-import" area-hidden="true" title="Import tags"></span>
                                    </a>
                                    <a href="{{url_for('gui.export_result_tags_to_soft_matches',id=mainresult.id)}}">
                                        <span class="glyphicon glyphicon-export" area-hidden="true" title="Export tags"></span>
                                    </a>
                                </div>
                                <div class="panel-body">
                                    {% set result = mainresult %}
                                    {% for tag in result.tags %}
                                        {% include 'tag/_deleteable_result_tag_preview.html' %}
                                    {% endfor %}
                                    {% include 'tag/_result_tag_selector.html' %}
                                </div>
                            </div>
                        </div>
                        <div class="col-md-9">
                            <div class="panel panel-default">
                                <div class="panel-heading"><h4 class="panel-title">Notes</h4></div>
                                <div class="panel-body">
                                    {% set result = mainresult %}
                                    {% include 'result/_notes_field.html' %}
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row show-grid">
                        <div class="col-md-12">
                            <div class="panel panel-default">
                                <div class="panel-heading"><h4 class="panel-title">Finding</h4></div>
                                <div class="panel-body"><div class="well well-sm">{{ mainresult.get_markdown()|safe }}</div></div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    <h4 class="panel-title">Properties <span class="badge">{{ mainresult.properties|list|length }}</span></h4>
                                </div>
                                <div class="panel-body">
                                    {% set properties = mainresult.properties %}
                                    {% include 'property/_properties_table.html' %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="panel-group">
        <div class="panel panel-info">
            <div class="panel-heading">
                <h2 class="panel-title">
                    <a class="collapse-toggle collapsed" data-toggle="collapse" href="#properties-collapse">Properties <span class="badge">{{ mainresult.properties|list|length }}</a>
                </h2>
            </div>
            <div id="properties-collapse" class="panel-collapse collapse">
                {% for property in result.properties %}
                    <table class="table table-bordered table-hover">
                        <table class="table table-bordered table-hover">
                            {% include 'property/_property_panel_header.html' %}
                            {% include 'property/_property_panel.html' %}
                        </table>
                    </table>
                {% endfor %}
            </div>
        </div>
    </div>
    {% include 'result/_result_click_script.html' %}
    {% include 'util/_note_update.html' %}
{% endblock %}

{% block scripts %}
    {{ super() }}
    {% include 'result/_result_click_script.html' %}
    {% include 'util/_search_bar_script.html' %}
    {% include 'util/_note_update.html' %}
    {% include 'tag/_tag_selector_script.html' %}
{% endblock %}